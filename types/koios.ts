/**
 * Koios API Response Types
 * Documentation: https://api.koios.rest/
 */

// Base types
export interface KoiosResponse<T> {
  data?: T;
  error?: string;
}

// DRep List Response
export interface DRepListItem {
  drep_id: string;
  drep_hash: string;
  hex: string;
  has_script: boolean;
  registered: boolean;
}

export type DRepListResponse = DRepListItem[];

// DRep Info Response
export interface DRepInfo {
  drep_id: string;
  drep_hash: string;
  hex: string;
  has_script: boolean;
  registered: boolean;
  deposit: string | null;
  anchor_url: string | null;
  anchor_hash: string | null;
  amount: string; // Total voting power in lovelace
  delegators: number;
  active_epoch: number | null;
}

export type DRepInfoResponse = DRepInfo[];

// DRep Metadata Response
export interface DRepMetadata {
  drep_id: string;
  hex: string;
  has_script: boolean;
  meta_url: string | null;
  meta_hash: string | null;
  meta_json: {
    name?: string;
    ticker?: string;
    description?: string;
    body?: {
      // CIP-119 Governance Metadata Fields
      givenName?: string;
      objectives?: string;
      motivations?: string;
      qualifications?: string;
      paymentAddress?: string;
      // Legacy/Additional Fields
      bio?: string;
      email?: string;
      references?: Array<{
        label: string;
        uri: string;
      }>;
      [key: string]: any;
    };
    authors?: string[];
    [key: string]: any;
  } | null;
  bytes: string | null;
  warning: string | null;
  language: string | null;
  comment: string | null;
  is_valid: boolean | null;
}

export type DRepMetadataResponse = DRepMetadata[];

// DRep Votes Response (Governance Actions)
export interface DRepVote {
  proposal_tx_hash: string;
  proposal_index: number;
  vote_tx_hash: string;
  block_time: number;
  vote: 'Yes' | 'No' | 'Abstain';
  meta_url: string | null;
  meta_hash: string | null;
  meta_json: {
    // CIP-100 nests rationale under body.comment or body.rationale
    body?: {
      comment?: string;
      rationale?: string;
      motivation?: string;
      [key: string]: any;
    };
    // Flat format fallback
    title?: string;
    abstract?: string;
    motivation?: string;
    rationale?: string;
    [key: string]: any;
  } | null;
  epoch_no?: number;
}

export type DRepVotesResponse = DRepVote[];

// Proposal Info (for governance actions from /proposal_list)
export interface ProposalInfo {
  proposal_tx_hash: string;
  proposal_index: number;
  proposal_type: 'TreasuryWithdrawals' | 'ParameterChange' | 'HardForkInitiation' 
                | 'InfoAction' | 'NoConfidence' | 'NewCommittee' | 'NewConstitution'
                | 'NewConstitutionalCommittee' | 'UpdateConstitution';
  proposal_description: string | null;
  deposit: string;
  return_address: string;
  proposed_epoch: number;
  ratified_epoch: number | null;
  enacted_epoch: number | null;
  dropped_epoch: number | null;
  expired_epoch: number | null;
  expiration: number | null;
  meta_url: string | null;
  meta_hash: string | null;
  meta_json: {
    // CIP-108 nests content under `body`
    body?: {
      title?: string;
      abstract?: string;
      motivation?: string;
      rationale?: string;
      references?: Array<{ uri?: string; label?: string; '@type'?: string }>;
      [key: string]: any;
    };
    // Flat fallback (older proposals)
    title?: string;
    abstract?: string;
    motivation?: string;
    rationale?: string;
    [key: string]: any;
  } | null;
  meta_comment: string | null;
  meta_is_valid: boolean | null;
  withdrawal: {
    stake_address: string;
    amount: string;
  }[] | null;
  param_proposal: Record<string, unknown> | null;
  block_time: number;
}

export type ProposalListResponse = ProposalInfo[];

// Classified proposal (after processing)
export interface ClassifiedProposal {
  txHash: string;
  index: number;
  type: ProposalInfo['proposal_type'];
  title: string;
  abstract: string | null;
  withdrawalAmountAda: number | null;
  treasuryTier: 'routine' | 'significant' | 'major' | null;
  paramChanges: Record<string, unknown> | null;
  relevantPrefs: string[];
  proposedEpoch: number;
  blockTime: number;
  ratifiedEpoch: number | null;
  enactedEpoch: number | null;
  droppedEpoch: number | null;
  expiredEpoch: number | null;
  expirationEpoch: number | null;
}
